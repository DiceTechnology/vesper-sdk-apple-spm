// swift-tools-version: 6.1
// The swift-tools-version declares the minimum version of Swift required to build this package.

import PackageDescription
import Foundation

let release = "2.0.1"
let cdnBaseURL = "https://d1st2jzonb6gjl.cloudfront.net/vesper/\(release)/spm"

//autogenerated
let xcFrameworks: [(name: String, checksum: String)] = [
    ("AVDoris", "196160ec9e09e0ef796146da855ad6ed3e40260163cf234e552e922d60b919e3"),
    ("dice_shield_ios", "3f701fe25915a42feea750401e474e223a53d678c41c033f0b2e6fa29e1c2a06"),
    ("DzAVPlayerAdapter", "f90dd053d88705262dcdfda756350511c1b7fb4f71de9c94ef0b1b5aed55b2e1"),
    ("DzBase", "efd86f6bd92068ae3f9ed60e5ff615c4a704a1fb85c3c0648df9245a6b7054c1"),
    ("DzMediaTailorAdapter", "bde0e2f34119264952948685a52bd731ff758ca4705b5880e7dc5b5dd9a7ddde"),
    ("GoogleCast", "3f88d26673327eb278b84a4e1713d01ef0db4256891154976c7b011d998f0a18"),
    ("MediaTailorSDK", "bbaea3e1c2c4f38a651cb8e80b0ebc5f76c1f75140e4a4b12aee8defaea01f08"),
    ("OMSDK_Elemental", "5977d5de3dbc68f5db305577da92cb9e27e50816988a52278623be9f64592ae7"),
    ("OMSDK_Yospace", "defc6cca79c46ce9ef7eef3fc576377db1f3bd70aa142b7b4cfb83b1115d8898"),
    ("ProgrammaticAccessLibrary", "9d69207efb62cf87daa90437a86f78de4650d92263f6ac08bb064427bf488aa0"),
    ("RxSwift", "d666048d53557f89e030824ad263ffd3abce055d5982079871991b65233ccd0f"),
    ("VesperPubNub", "6a40d7adc479325ef5ef7ae1da323634bd8837987aa123a577f668ba11c8f78b"),
    ("VesperSDK", "d24c0068487ce895a1db139362c8396920359626b65c479c7842bcde0e41abb3"),
    ("YOAdManagement", "e58bf1213ad130c27ff3cf77178691577d8dd31984bc95f3ba6e5a274a6be5a2"),
    ("YOOpenMeasurementAdapter", "910e4840fd3f2623ff6d4f6c47b7c2fd562fd07cf7e50cd52f55ce459a07c8e7"),
] 

let remoteBinaryTargets: [Target] = xcFrameworks.map { target in
    return .binaryTarget(
        name: target.name,
        url: "\(cdnBaseURL)/iphoneFrameworks/\(target.name).xcframework.zip",
        checksum: target.checksum
    )
}

let localBinaryTargets: [Target] = xcFrameworks.map { target in
    .binaryTarget(
        name: target.name,
        path: "./iphoneFrameworks/\(target.name).xcframework"
    )
}

let privateTargetDependencies: [Target.Dependency] = xcFrameworks.map { Target.Dependency(stringLiteral: $0.name) }
let publicTargetDependencies: [Target.Dependency] = [
    .product(name: "MUXSDKStats", package: "mux-stats-sdk-avplayer"),
    .product(name: "GoogleInteractiveMediaAds", package: "swift-package-manager-google-interactive-media-ads-ios"),
    .product(name: "ConvivaAVFoundation", package: "conviva-ios-avfoundation-spm"),
]

let shouldUseLocalBinaryTargets = false
let binaryTargets = shouldUseLocalBinaryTargets ? localBinaryTargets : remoteBinaryTargets

let wrapperTarget: Target = .target(
    name: "VesperSDKWrapper",
    dependencies: privateTargetDependencies + publicTargetDependencies,
    resources: [.embedInCode("Resources")]
)

let packagePlatforms: [SupportedPlatform] = [.iOS(.v15)]
let packageProducts: [Product] = [.library(name: "VesperSDK", targets: ["VesperSDKWrapper"])]
let packageDependencies: [Package.Dependency] = [
    .package(url: "https://github.com/muxinc/mux-stats-sdk-avplayer", .upToNextMajor(from: "3.6.2")),
    .package(url: "https://github.com/googleads/swift-package-manager-google-interactive-media-ads-ios", .upToNextMajor(from: "3.22.0")),
    .package(url: "https://github.com/Conviva/conviva-ios-avfoundation-spm", .upToNextMinor(from: "4.0.51")),
]
let packageTargets = [wrapperTarget] + binaryTargets

let package = Package(
    name: "VesperSDK",
    platforms: packagePlatforms,
    products: packageProducts,
    dependencies: packageDependencies,
    targets: packageTargets
)

