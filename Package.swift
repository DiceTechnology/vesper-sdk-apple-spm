// swift-tools-version: 6.1
// The swift-tools-version declares the minimum version of Swift required to build this package.

import PackageDescription
import Foundation

let release = "2.1.0"
let cdnBaseURL = "https://d1st2jzonb6gjl.cloudfront.net/vesper/\(release)/spm"

//autogenerated
let xcFrameworks: [(name: String, checksum: String)] = [
    ("AVDoris", "7d05adea9990f03be58ccd1bd8fc75710f1a4608e7c07da11aa0c2301b38ca66"),
    ("dice_shield_ios", "0d809b96b68a868c70bd73855cd6efdec536c52ea431a24bd7b5881b76a2f589"),
    ("DzAVPlayerAdapter", "cedffe4ca7252c789c2a53da12149c8ec2d5e09b0157320f7e0251c9d1c1248c"),
    ("DzBase", "0c4b213a4f923c5051dabdd730eb3b04175c20c938fef021d703fe0a5625a1bd"),
    ("DzMediaTailorAdapter", "db80dd023f1102ccfb7f312e2adb98baea006703ec32d3f17ee1f66e14aab5f6"),
    ("GoogleCast", "96242e39a7a9529efca66f5e0fa8eb6515f5219fd2f087ff85f62d43c1f3f228"),
    ("MediaTailorSDK", "4c550164c391574031b00af7a29868e9eb63b2a6a00843eb39327afcd5a2b3d6"),
    ("OMSDK_Elemental", "9c1b4e7dc39c7575769dafcc7a1f572233b40d0300d0e7900ce54c241e77d4a2"),
    ("OMSDK_Yospace", "9aedc73f25d615184bf51a335fae574f6db7517265fb5d1bd4171ccf32cd51fd"),
    ("ProgrammaticAccessLibrary", "a0511c702966eb035116a2d20efb76034bc45248540ec660cf45757ad0be073b"),
    ("RxSwift", "44ccb8cced2fb41a3e8ae97fe82d8c03880059440eb79932a9a9286b16105777"),
    ("VesperPubNub", "3009d319ed1cc26280aafa177a44d7d26453aa055d19237c2d5feb32bd21b182"),
    ("VesperSDK", "5cbeaaf3db6a0a81e2492c92ff5a10b5f9d180e85597930b027ff3c2c7f231b5"),
    ("YOAdManagement", "476e7a7c9f9ecde60a0230aea761388c7123bd72c41649983d2acb3e24e33d49"),
    ("YOOpenMeasurementAdapter", "011cc05aa652d824261b1a084cece08e33b62fabc3df0515f7a3ab6396a32ccd"),
] 

let remoteBinaryTargets: [Target] = xcFrameworks.map { target in
    return .binaryTarget(
        name: target.name,
        url: "\(cdnBaseURL)/iphoneFrameworks/\(target.name).xcframework.zip",
        checksum: target.checksum
    )
}

let localBinaryTargets: [Target] = xcFrameworks.map { target in
    .binaryTarget(
        name: target.name,
        path: "./iphoneFrameworks/\(target.name).xcframework"
    )
}

let privateTargetDependencies: [Target.Dependency] = xcFrameworks.map { Target.Dependency(stringLiteral: $0.name) }
let publicTargetDependencies: [Target.Dependency] = [
    .product(name: "MUXSDKStats", package: "mux-stats-sdk-avplayer"),
    .product(name: "GoogleInteractiveMediaAds", package: "swift-package-manager-google-interactive-media-ads-ios"),
    .product(name: "ConvivaAVFoundation", package: "conviva-ios-avfoundation-spm"),
]

let shouldUseLocalBinaryTargets = false
let binaryTargets = shouldUseLocalBinaryTargets ? localBinaryTargets : remoteBinaryTargets

let wrapperTarget: Target = .target(
    name: "VesperSDKWrapper",
    dependencies: privateTargetDependencies + publicTargetDependencies,
    resources: [.embedInCode("Resources")]
)

let packagePlatforms: [SupportedPlatform] = [.iOS(.v15)]
let packageProducts: [Product] = [.library(name: "VesperSDK", targets: ["VesperSDKWrapper"])]
let packageDependencies: [Package.Dependency] = [
    .package(url: "https://github.com/muxinc/mux-stats-sdk-avplayer", .upToNextMajor(from: "3.6.2")),
    .package(url: "https://github.com/googleads/swift-package-manager-google-interactive-media-ads-ios", .upToNextMajor(from: "3.22.0")),
    .package(url: "https://github.com/Conviva/conviva-ios-avfoundation-spm", .upToNextMinor(from: "4.0.51")),
]
let packageTargets = [wrapperTarget] + binaryTargets

let package = Package(
    name: "VesperSDK",
    platforms: packagePlatforms,
    products: packageProducts,
    dependencies: packageDependencies,
    targets: packageTargets
)

